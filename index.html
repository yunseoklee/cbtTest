<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISTQB CTFL 모의고사 CBT - JSON 기반</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-content {
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #5e72e4;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .json-status {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 14px;
        }

        .json-status.success {
            background: rgba(39, 174, 96, 0.3);
        }

        .json-status.error {
            background: rgba(231, 76, 60, 0.3);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
            position: relative;
        }

        .tab.active {
            background: white;
            color: #5e72e4;
            border-bottom: 3px solid #5e72e4;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab .badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 11px;
        }

        .content {
            padding: 30px;
            min-height: 500px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 오답노트 스타일 */
        .review-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .review-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .review-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .review-card.flipped {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .card-number {
            background: #5e72e4;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .card-tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .tag {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 11px;
            background: #e9ecef;
            color: #495057;
        }

        .tag.difficulty-상 {
            background: #f8d7da;
            color: #721c24;
        }

        .tag.difficulty-중 {
            background: #fff3cd;
            color: #856404;
        }

        .tag.difficulty-하 {
            background: #d4edda;
            color: #155724;
        }

        .card-question {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .card-answer {
            display: none;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #5e72e4;
        }

        .card-answer.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        .card-category {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 11px;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 20px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .filter-btn.active {
            background: #5e72e4;
            color: white;
            border-color: #5e72e4;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            padding: 8px 15px;
            border: 2px solid #dee2e6;
            border-radius: 20px;
            font-size: 14px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 14px;
        }

        .json-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            margin-bottom: 20px;
        }

        .json-upload-area.dragover {
            border-color: #5e72e4;
            background: #e8ebff;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(94, 114, 228, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .progress-bar {
            background: #dee2e6;
            height: 10px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #5e72e4, #825ee4);
            height: 100%;
            transition: width 0.5s;
        }

        .category-progress {
            margin-bottom: 20px;
        }

        .category-item {
            margin-bottom: 15px;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .review-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                overflow-x: auto;
            }
            
            .tab {
                min-width: 100px;
            }
            
            .filter-controls {
                flex-direction: column;
            }
            
            .search-box {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- 로딩 화면 -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>ISTQB CBT 시스템 로딩중...</h3>
            <p>오답노트 데이터를 불러오고 있습니다.</p>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>🎓 ISTQB CTFL 모의고사</h1>
            <p>Certified Tester Foundation Level v4.0</p>
            <div id="json-status" class="json-status">
                JSON 파일 상태: 확인중...
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showSection('review')">
                📊 오답노트
                <span class="badge" id="review-count">0</span>
            </button>
            <button class="tab" onclick="showSection('stats')">📈 학습 통계</button>
            <button class="tab" onclick="showSection('settings')">⚙️ JSON 관리</button>
        </div>

        <div class="content">
            <!-- 오답노트 섹션 -->
            <div id="review" class="section active">
                <h2 style="margin-bottom: 20px;">오답노트 학습</h2>
                
                <div class="filter-controls">
                    <button class="filter-btn active" onclick="filterReview('all')">전체</button>
                    <button class="filter-btn" onclick="filterReview('상')">난이도: 상</button>
                    <button class="filter-btn" onclick="filterReview('중')">난이도: 중</button>
                    <button class="filter-btn" onclick="filterReview('하')">난이도: 하</button>
                    <input type="text" class="search-box" id="search-input" placeholder="🔍 문제나 답변 검색..." onkeyup="searchReview()">
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="study-progress" style="width: 0%;"></div>
                </div>

                <div id="review-grid" class="review-grid">
                    <!-- 카드들이 여기에 동적으로 로드됨 -->
                </div>
            </div>

            <!-- 통계 섹션 -->
            <div id="stats" class="section">
                <h2 style="margin-bottom: 20px;">학습 통계</h2>
                
                <div class="stats-container">
                    <div class="stat-box">
                        <div class="stat-value" id="total-questions">0</div>
                        <div class="stat-label">전체 문제</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="studied-questions">0</div>
                        <div class="stat-label">학습 완료</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="mastery-rate">0%</div>
                        <div class="stat-label">숙달도</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="last-updated">-</div>
                        <div class="stat-label">마지막 업데이트</div>
                    </div>
                </div>

                <h3 style="margin: 30px 0 20px;">카테고리별 진도</h3>
                <div id="category-progress" class="category-progress">
                    <!-- 카테고리별 진도가 여기에 표시됨 -->
                </div>
            </div>

            <!-- JSON 관리 섹션 -->
            <div id="settings" class="section">
                <h2 style="margin-bottom: 20px;">JSON 파일 관리</h2>
                
                <div class="json-upload-area" id="drop-zone">
                    <h3>📁 JSON 파일 업로드</h3>
                    <p style="margin: 20px 0;">오답노트 JSON 파일을 드래그 & 드롭하거나 선택하세요</p>
                    <input type="file" id="json-file-input" accept=".json" style="display: none;">
                    <button class="btn btn-primary" onclick="document.getElementById('json-file-input').click()">
                        파일 선택
                    </button>
                    <button class="btn btn-secondary" onclick="downloadCurrentJSON()">
                        현재 JSON 다운로드
                    </button>
                </div>

                <div style="margin-top: 30px;">
                    <h3>JSON 파일 URL 로드</h3>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <input type="text" id="json-url" class="search-box" 
                               placeholder="JSON 파일 URL 입력 (예: review-notes.json)"
                               value="review-notes.json">
                        <button class="btn btn-primary" onclick="loadJSONFromURL()">URL에서 로드</button>
                    </div>
                </div>

                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 15px;">
                    <h3>사용 방법</h3>
                    <ol style="margin-top: 15px; line-height: 1.8;">
                        <li>review-notes.json 파일을 같은 폴더에 저장</li>
                        <li>JSON 파일을 직접 업로드하거나 URL로 로드</li>
                        <li>파일 수정 후 재업로드하여 업데이트</li>
                        <li>학습 진도는 브라우저에 자동 저장</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- 상세 보기 모달 -->
    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>문제 상세</h2>
                <span class="close-btn" onclick="closeModal()">&times;</span>
            </div>
            <div id="modal-body">
                <!-- 상세 내용이 여기에 표시됨 -->
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let reviewData = null;
        let currentFilter = 'all';
        let studiedQuestions = new Set();
        let masteredQuestions = new Set();

        // LocalStorage 키
        const STORAGE_KEYS = {
            STUDIED: 'istqb_studied_questions',
            MASTERED: 'istqb_mastered_questions',
            JSON_DATA: 'istqb_review_data'
        };

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', async function() {
            setupEventListeners();
            loadFromStorage();
            
            // JSON 파일 자동 로드 시도
            await loadJSONFromURL();
            
            // 로딩 화면 숨기기
            setTimeout(() => {
                document.getElementById('loading-screen').style.display = 'none';
            }, 1000);
        });

        // 이벤트 리스너 설정
        function setupEventListeners() {
            // 파일 드래그 & 드롭
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('json-file-input');

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === 'application/json') {
                    handleFileUpload(files[0]);
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
        }

        // LocalStorage에서 데이터 로드
        function loadFromStorage() {
            try {
                const savedStudied = localStorage.getItem(STORAGE_KEYS.STUDIED);
                const savedMastered = localStorage.getItem(STORAGE_KEYS.MASTERED);
                const savedJSON = localStorage.getItem(STORAGE_KEYS.JSON_DATA);
                
                if (savedStudied) studiedQuestions = new Set(JSON.parse(savedStudied));
                if (savedMastered) masteredQuestions = new Set(JSON.parse(savedMastered));
                if (savedJSON) {
                    reviewData = JSON.parse(savedJSON);
                    updateUI();
                }
            } catch (e) {
                console.error('Failed to load from storage:', e);
            }
        }

        // LocalStorage에 데이터 저장
        function saveToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.STUDIED, JSON.stringify(Array.from(studiedQuestions)));
                localStorage.setItem(STORAGE_KEYS.MASTERED, JSON.stringify(Array.from(masteredQuestions)));
                if (reviewData) {
                    localStorage.setItem(STORAGE_KEYS.JSON_DATA, JSON.stringify(reviewData));
                }
            } catch (e) {
                console.error('Failed to save to storage:', e);
            }
        }

        // URL에서 JSON 로드
        async function loadJSONFromURL() {
            const urlInput = document.getElementById('json-url');
            const url = urlInput ? urlInput.value : 'review-notes.json';
            const statusDiv = document.getElementById('json-status');
            
            // 다양한 경로 시도
            const possiblePaths = [
                url,
                './review-notes.json',
                'review-notes.json',
                '/review-notes.json',
                // GitHub Pages의 경우
                window.location.pathname.replace(/[^\/]*$/, '') + 'review-notes.json'
            ];
            
            let loaded = false;
            
            for (const path of possiblePaths) {
                try {
                    statusDiv.textContent = `JSON 파일 로딩 시도중... (${path})`;
                    statusDiv.className = 'json-status';
                    
                    const response = await fetch(path);
                    if (response.ok) {
                        const data = await response.json();
                        reviewData = data;
                        saveToStorage();
                        updateUI();
                        
                        statusDiv.textContent = `✅ JSON 파일 로드 완료 (${data.오답노트.length}개 문제)`;
                        statusDiv.className = 'json-status success';
                        loaded = true;
                        break;
                    }
                } catch (error) {
                    console.log(`Failed to load from ${path}:`, error.message);
                }
            }
            
            if (!loaded) {
                // JSON 파일을 찾을 수 없는 경우, 내장 데이터 사용
                statusDiv.textContent = '⚠️ 외부 JSON 파일을 찾을 수 없어 내장 데이터를 사용합니다.';
                statusDiv.className = 'json-status error';
                
                // LocalStorage 확인
                const savedData = localStorage.getItem(STORAGE_KEYS.JSON_DATA);
                if (savedData) {
                    reviewData = JSON.parse(savedData);
                    statusDiv.textContent += ' (저장된 데이터 사용중)';
                    updateUI();
                } else {
                    // 내장 기본 데이터 사용
                    loadEmbeddedData();
                }
            }
        }
        
        // 내장 데이터 로드
        function loadEmbeddedData() {
            reviewData = {
                "lastUpdated": "2024-12-27",
                "version": "1.0",
                "오답노트": [
                    {"id": 1, "문제": "회귀 테스팅을 수행하는 가장 중요한 이유는?", "답변": "변경사항이 기존 기능에 영향을 주지 않았는지 확인", "카테고리": "테스트 레벨", "난이도": "중", "태그": ["회귀테스팅", "변경관리"]},
                    {"id": 2, "문제": "테스트 레벨의 순서로 올바른 것은?", "답변": "단위 테스팅 → 통합 테스팅 → 시스템 테스팅 → 인수 테스팅", "카테고리": "테스트 레벨", "난이도": "상", "태그": ["테스트레벨", "순서"]},
                    {"id": 3, "문제": "V모델에서 단위 테스팅과 대응되는 개발 활동은?", "답변": "상세 설계", "카테고리": "테스트 레벨", "난이도": "중", "태그": ["V모델", "단위테스팅"]},
                    {"id": 4, "문제": "시프트 레프트(Shift-Left) 접근법의 주요 이점은?", "답변": "결함을 조기에 발견하여 수정 비용 절감", "카테고리": "테스트 원칙", "난이도": "중", "태그": ["시프트레프트", "조기테스팅"]},
                    {"id": 5, "문제": "오류(Error), 결함(Defect), 장애(Failure)의 관계로 올바른 것은?", "답변": "오류가 결함을 만들고, 결함이 장애를 일으킬 수 있다", "카테고리": "테스트 기초", "난이도": "상", "태그": ["오류", "결함", "장애"]},
                    {"id": 6, "문제": "동등 분할(Equivalence Partitioning) 기법의 목적은?", "답변": "입력 도메인을 동일하게 처리될 것으로 예상되는 그룹으로 나누어 대표값을 테스트", "카테고리": "테스트 기법", "난이도": "중", "태그": ["동등분할", "블랙박스"]},
                    {"id": 7, "문제": "경계값 분석(Boundary Value Analysis)에서 2-포인트 기법을 적용할 때 테스트하는 값은?", "답변": "유효 범위의 최솟값과 최댓값", "카테고리": "테스트 기법", "난이도": "중", "태그": ["경계값분석", "블랙박스"]},
                    {"id": 8, "문제": "100% 구문 커버리지(Statement Coverage)를 달성했다는 의미는?", "답변": "모든 실행 가능한 코드 라인이 최소 한 번 실행되었음", "카테고리": "테스트 기법", "난이도": "중", "태그": ["구문커버리지", "화이트박스"]},
                    {"id": 9, "문제": "결정 테이블 테스팅이 가장 유용한 상황은?", "답변": "복잡한 비즈니스 규칙과 여러 조건의 조합을 테스트할 때", "카테고리": "테스트 기법", "난이도": "중", "태그": ["결정테이블", "조건조합"]},
                    {"id": 10, "문제": "탐색적 테스팅의 특징은?", "답변": "학습, 테스트 설계, 테스트 실행을 동시에 수행", "카테고리": "테스트 기법", "난이도": "하", "태그": ["탐색적테스팅", "경험기반"]},
                    {"id": 11, "문제": "정적 테스팅과 동적 테스팅의 차이는?", "답변": "정적: 코드를 실행하지 않고 수행, 동적: 코드를 실행하며 수행", "카테고리": "정적 테스팅", "난이도": "하", "태그": ["정적테스팅", "동적테스팅"]},
                    {"id": 12, "문제": "가장 공식적인 리뷰 유형은?", "답변": "인스펙션(Inspection) - 역할 정의, 체크리스트 사용, 메트릭 수집", "카테고리": "정적 테스팅", "난이도": "중", "태그": ["인스펙션", "리뷰"]},
                    {"id": 13, "문제": "리스크 기반 테스팅의 주요 목적은?", "답변": "제품 리스크가 높은 영역에 테스트 노력을 집중", "카테고리": "테스트 관리", "난이도": "중", "태그": ["리스크기반", "우선순위"]},
                    {"id": 14, "문제": "테스트 종료 조건(Exit Criteria)의 예시가 아닌 것은?", "답변": "테스트 환경 준비 완료 (이것은 진입 조건)", "카테고리": "테스트 관리", "난이도": "중", "태그": ["종료조건", "진입조건"]},
                    {"id": 15, "문제": "애자일 개발에서 테스팅의 특징은?", "답변": "각 스프린트마다 지속적 테스팅과 빠른 피드백", "카테고리": "개발 방법론", "난이도": "중", "태그": ["애자일", "스프린트"]},
                    {"id": 16, "문제": "테스트 자동화가 가장 효과적인 테스트 유형은?", "답변": "회귀 테스팅 (반복 실행으로 ROI 높음)", "카테고리": "테스트 자동화", "난이도": "하", "태그": ["자동화", "회귀테스팅"]},
                    {"id": 17, "문제": "검증(Verification)과 확인(Validation)의 차이는?", "답변": "검증: 제품을 올바르게 만드는가, 확인: 올바른 제품을 만드는가", "카테고리": "테스트 기초", "난이도": "상", "태그": ["검증", "확인", "V&V"]},
                    {"id": 18, "문제": "결함 우선순위와 심각도의 관계는?", "답변": "독립적으로 결정 가능 (심각도: 기술적 영향, 우선순위: 비즈니스 중요도)", "카테고리": "결함 관리", "난이도": "중", "태그": ["결함", "우선순위", "심각도"]},
                    {"id": 19, "문제": "테스트 피라미드의 구조는?", "답변": "하단에 단위 테스트(많음), 중간에 통합 테스트, 상단에 E2E 테스트(적음)", "카테고리": "테스트 전략", "난이도": "중", "태그": ["테스트피라미드", "테스트전략"]},
                    {"id": 20, "문제": "테스트 오라클(Test Oracle)이란?", "답변": "테스트 실행 결과가 올바른지 판단하기 위한 정보의 소스", "카테고리": "테스트 기초", "난이도": "중", "태그": ["테스트오라클", "기대결과"]},
                    {"id": 21, "문제": "블랙박스 테스트와 화이트박스 테스트의 차이는?", "답변": "블랙박스: 내부 구조를 모르고 기능 테스트, 화이트박스: 내부 구조를 알고 테스트", "카테고리": "테스트 기법", "난이도": "하", "태그": ["블랙박스", "화이트박스"]},
                    {"id": 22, "문제": "테스트 더블(Test Double)의 종류는?", "답변": "Dummy, Stub, Spy, Mock, Fake", "카테고리": "테스트 기법", "난이도": "상", "태그": ["테스트더블", "Mock"]},
                    {"id": 23, "문제": "연기 테스트(Smoke Test)의 목적은?", "답변": "빌드의 기본적인 기능이 동작하는지 확인하여 상세 테스트 진행 여부 결정", "카테고리": "테스트 레벨", "난이도": "중", "태그": ["연기테스트", "빌드검증"]},
                    {"id": 24, "문제": "테스트 케이스의 필수 구성 요소는?", "답변": "사전조건, 입력값, 수행 절차, 기대 결과, 사후조건", "카테고리": "테스트 설계", "난이도": "하", "태그": ["테스트케이스", "구성요소"]},
                    {"id": 25, "문제": "결함 라이프사이클의 일반적인 순서는?", "답변": "New → Open → Assigned → Fixed → Retest → Closed", "카테고리": "결함 관리", "난이도": "중", "태그": ["결함라이프사이클", "상태전이"]}
                ]
            };
            
            saveToStorage();
            updateUI();
            
            const statusDiv = document.getElementById('json-status');
            statusDiv.textContent = `✅ 내장 데이터 로드 완료 (${reviewData.오답노트.length}개 문제)`;
            statusDiv.className = 'json-status success';
        }

        // 파일 업로드 처리
        function handleFileUpload(file) {
            const reader = new FileReader();
            const statusDiv = document.getElementById('json-status');
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    reviewData = data;
                    saveToStorage();
                    updateUI();
                    
                    statusDiv.textContent = `✅ JSON 파일 업로드 완료 (${data.오답노트.length}개 문제)`;
                    statusDiv.className = 'json-status success';
                    
                    alert('JSON 파일이 성공적으로 업로드되었습니다!');
                } catch (error) {
                    statusDiv.textContent = `❌ JSON 파일 파싱 실패: ${error.message}`;
                    statusDiv.className = 'json-status error';
                    alert('올바른 JSON 형식이 아닙니다.');
                }
            };
            
            reader.readAsText(file);
        }

        // 현재 JSON 다운로드
        function downloadCurrentJSON() {
            if (!reviewData) {
                alert('다운로드할 데이터가 없습니다.');
                return;
            }
            
            const dataStr = JSON.stringify(reviewData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', `review-notes-${new Date().toISOString().split('T')[0]}.json`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // UI 업데이트
        function updateUI() {
            if (!reviewData || !reviewData.오답노트) return;
            
            displayReviewCards();
            updateStatistics();
            updateCategoryProgress();
            
            // 탭 배지 업데이트
            document.getElementById('review-count').textContent = reviewData.오답노트.length;
        }

        // 오답노트 카드 표시
        function displayReviewCards() {
            const grid = document.getElementById('review-grid');
            grid.innerHTML = '';
            
            let filteredData = reviewData.오답노트;
            
            // 필터 적용
            if (currentFilter !== 'all') {
                filteredData = filteredData.filter(item => item.난이도 === currentFilter);
            }
            
            // 검색어 적용
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            if (searchTerm) {
                filteredData = filteredData.filter(item => 
                    item.문제.toLowerCase().includes(searchTerm) || 
                    item.답변.toLowerCase().includes(searchTerm) ||
                    (item.태그 && item.태그.some(tag => tag.toLowerCase().includes(searchTerm)))
                );
            }
            
            filteredData.forEach(item => {
                const card = createReviewCard(item);
                grid.appendChild(card);
            });
            
            // 진도 업데이트
            updateStudyProgress();
        }

        // 오답노트 카드 생성
        function createReviewCard(item) {
            const card = document.createElement('div');
            card.className = 'review-card';
            if (studiedQuestions.has(item.id)) {
                card.classList.add('studied');
            }
            
            card.innerHTML = `
                <div class="card-header">
                    <span class="card-number">#${item.id}</span>
                    <span class="card-category">${item.카테고리}</span>
                </div>
                <div class="card-tags">
                    <span class="tag difficulty-${item.난이도}">${item.난이도}</span>
                    ${item.태그 ? item.태그.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}
                </div>
                <div class="card-question">${item.문제}</div>
                <div class="card-answer" id="answer-${item.id}">
                    <strong>정답:</strong><br>
                    ${item.답변}
                </div>
                <button class="btn btn-primary" onclick="toggleAnswer(${item.id})" style="margin-top: 15px; padding: 8px 20px; font-size: 14px;">
                    정답 보기
                </button>
            `;
            
            card.addEventListener('dblclick', () => showDetailModal(item));
            
            return card;
        }

        // 답변 토글
        function toggleAnswer(id) {
            const answerDiv = document.getElementById(`answer-${id}`);
            answerDiv.classList.toggle('show');
            
            // 학습 완료 표시
            if (!studiedQuestions.has(id)) {
                studiedQuestions.add(id);
                saveToStorage();
                updateStatistics();
                updateStudyProgress();
            }
            
            event.stopPropagation();
        }

        // 상세 모달 표시
        function showDetailModal(item) {
            const modal = document.getElementById('detail-modal');
            const modalBody = document.getElementById('modal-body');
            
            modalBody.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <span class="card-number">#${item.id}</span>
                    <span class="card-category" style="margin-left: 10px;">${item.카테고리}</span>
                    <span class="tag difficulty-${item.난이도}" style="margin-left: 10px;">${item.난이도}</span>
                </div>
                <h3 style="color: #2c3e50; margin-bottom: 20px;">문제</h3>
                <p style="font-size: 18px; line-height: 1.6; margin-bottom: 30px;">${item.문제}</p>
                <h3 style="color: #27ae60; margin-bottom: 20px;">정답</h3>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #27ae60;">
                    ${item.답변}
                </div>
                ${item.태그 ? `
                    <div style="margin-top: 20px;">
                        <strong>관련 태그:</strong>
                        ${item.태그.map(tag => `<span class="tag" style="margin: 5px;">${tag}</span>`).join('')}
                    </div>
                ` : ''}
                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-success" onclick="markAsMastered(${item.id})">
                        ${masteredQuestions.has(item.id) ? '✅ 완전 숙달' : '⭐ 숙달 표시'}
                    </button>
                    <button class="btn btn-secondary" onclick="closeModal()">닫기</button>
                </div>
            `;
            
            modal.classList.add('show');
        }

        // 모달 닫기
        function closeModal() {
            document.getElementById('detail-modal').classList.remove('show');
        }

        // 숙달 표시
        function markAsMastered(id) {
            if (masteredQuestions.has(id)) {
                masteredQuestions.delete(id);
            } else {
                masteredQuestions.add(id);
                studiedQuestions.add(id);
            }
            saveToStorage();
            updateStatistics();
            closeModal();
        }

        // 필터링
        function filterReview(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            displayReviewCards();
        }

        // 검색
        function searchReview() {
            displayReviewCards();
        }

        // 통계 업데이트
        function updateStatistics() {
            if (!reviewData) return;
            
            const total = reviewData.오답노트.length;
            const studied = studiedQuestions.size;
            const mastered = masteredQuestions.size;
            const masteryRate = total > 0 ? Math.round((mastered / total) * 100) : 0;
            
            document.getElementById('total-questions').textContent = total;
            document.getElementById('studied-questions').textContent = studied;
            document.getElementById('mastery-rate').textContent = masteryRate + '%';
            document.getElementById('last-updated').textContent = reviewData.lastUpdated || '-';
        }

        // 학습 진도 업데이트
        function updateStudyProgress() {
            if (!reviewData) return;
            
            const total = reviewData.오답노트.length;
            const studied = studiedQuestions.size;
            const progress = total > 0 ? (studied / total) * 100 : 0;
            
            document.getElementById('study-progress').style.width = progress + '%';
        }

        // 카테고리별 진도 업데이트
        function updateCategoryProgress() {
            if (!reviewData) return;
            
            const container = document.getElementById('category-progress');
            container.innerHTML = '';
            
            // 카테고리별 집계
            const categories = {};
            reviewData.오답노트.forEach(item => {
                if (!categories[item.카테고리]) {
                    categories[item.카테고리] = { total: 0, studied: 0, mastered: 0 };
                }
                categories[item.카테고리].total++;
                if (studiedQuestions.has(item.id)) {
                    categories[item.카테고리].studied++;
                }
                if (masteredQuestions.has(item.id)) {
                    categories[item.카테고리].mastered++;
                }
            });
            
            // 카테고리별 진도 표시
            Object.entries(categories).forEach(([category, stats]) => {
                const progress = (stats.studied / stats.total) * 100;
                const masteryProgress = (stats.mastered / stats.total) * 100;
                
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                categoryItem.innerHTML = `
                    <div class="category-header">
                        <span>${category}</span>
                        <span>${stats.studied}/${stats.total} (숙달: ${stats.mastered})</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%; background: linear-gradient(90deg, #3498db ${masteryProgress}%, #5e72e4 ${masteryProgress}%);"></div>
                    </div>
                `;
                container.appendChild(categoryItem);
            });
        }

        // 섹션 전환
        function showSection(sectionName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(sectionName).classList.add('active');
        }
    </script>
</body>
</html>