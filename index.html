<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISTQB CTFL ëª¨ì˜ê³ ì‚¬ CBT - Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stats-bar {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
            display: flex;
            justify-content: space-around;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 100px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
            position: relative;
        }

        .tab.active {
            background: white;
            color: #5e72e4;
            border-bottom: 3px solid #5e72e4;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab .badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 11px;
        }

        .content {
            padding: 30px;
            min-height: 500px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ìš©ì–´ í•™ìŠµ ìŠ¤íƒ€ì¼ */
        .term-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            position: relative;
        }

        .term-card.bookmarked {
            border: 2px solid #f39c12;
        }

        .bookmark-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #ddd;
        }

        .bookmark-btn.active {
            color: #f39c12;
        }

        .term-title {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: bold;
            padding-right: 40px;
        }

        .term-definition {
            font-size: 16px;
            line-height: 1.8;
            color: #34495e;
            margin-bottom: 15px;
        }

        .term-importance {
            display: inline-block;
            padding: 5px 15px;
            background: #e74c3c;
            color: white;
            border-radius: 20px;
            font-size: 14px;
            margin-right: 10px;
        }

        .term-category {
            display: inline-block;
            padding: 5px 15px;
            background: #3498db;
            color: white;
            border-radius: 20px;
            font-size: 14px;
        }

        /* ëª¨ì˜ê³ ì‚¬ ìŠ¤íƒ€ì¼ */
        .quiz-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
        }

        .question {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 25px;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .question-number {
            display: inline-block;
            background: #5e72e4;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .options {
            margin-bottom: 20px;
        }

        .option {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: #5e72e4;
            background: #f8f9ff;
        }

        .option.selected {
            border-color: #5e72e4;
            background: #e8ebff;
        }

        .option.correct {
            border-color: #27ae60;
            background: #d4edda;
        }

        .option.incorrect {
            border-color: #e74c3c;
            background: #f8d7da;
        }

        .option input[type="radio"] {
            margin-right: 15px;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(94, 114, 228, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .score-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            margin-top: 20px;
        }

        .score-display h2 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        /* ì˜¤ë‹µë…¸íŠ¸ ìŠ¤íƒ€ì¼ */
        .review-item {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .review-item.incorrect {
            border-left: 5px solid #e74c3c;
        }

        .review-item.correct {
            border-left: 5px solid #27ae60;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .review-status {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .review-tag {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .tag-incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        .tag-correct {
            background: #d4edda;
            color: #155724;
        }

        .tag-category {
            background: #cce5ff;
            color: #004085;
        }

        .review-question {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            white-space: pre-wrap;
        }

        .review-options {
            margin-bottom: 20px;
        }

        .review-option {
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: #f8f9fa;
            position: relative;
            padding-left: 35px;
        }

        .review-option.user-selected {
            background: #fff3cd;
            border: 1px solid #ffc107;
        }

        .review-option.correct-answer {
            background: #d4edda;
            border: 1px solid #27ae60;
        }

        .review-option::before {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .review-option.user-selected::before {
            content: "ğŸ‘¤";
        }

        .review-option.correct-answer::before {
            content: "âœ…";
        }

        .review-explanation {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .review-explanation h4 {
            color: #2980b9;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .review-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 20px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .filter-btn.active {
            background: #5e72e4;
            color: white;
            border-color: #5e72e4;
        }

        /* í•™ìŠµ ì§„ë„ */
        .progress-bar {
            background: #dee2e6;
            height: 10px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #5e72e4, #825ee4);
            height: 100%;
            transition: width 0.5s;
        }

        .explanation {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
        }

        .explanation h4 {
            color: #2980b9;
            margin-bottom: 10px;
        }

        /* í”Œë˜ì‹œì¹´ë“œ ìŠ¤íƒ€ì¼ ê°œì„  */
        .flashcard-container {
            perspective: 1000px;
            margin-bottom: 30px;
        }

        .flashcard {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 40px;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.6s;
            transform-style: preserve-3d;
            position: relative;
        }

        .flashcard:hover {
            transform: scale(1.02);
        }

        .difficulty-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 5px 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            font-size: 12px;
        }

        .study-mode-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #5e72e4;
            background: white;
            color: #5e72e4;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: #5e72e4;
            color: white;
        }

        /* í†µê³„ ëŒ€ì‹œë³´ë“œ */
        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .tabs {
                overflow-x: auto;
            }
            
            .tab {
                min-width: 120px;
            }
            
            .quiz-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ ISTQB CTFL ëª¨ì˜ê³ ì‚¬</h1>
            <p>Certified Tester Foundation Level v4.0</p>
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="total-solved">0</div>
                    <div class="stat-label">ì´ ë¬¸ì œ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="correct-rate">0%</div>
                    <div class="stat-label">ì •ë‹µë¥ </div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="study-streak">0</div>
                    <div class="stat-label">ì—°ì† í•™ìŠµ</div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showSection('quiz')">ğŸ“ ëª¨ì˜ê³ ì‚¬</button>
            <button class="tab" onclick="showSection('review')">
                ğŸ“Š ì˜¤ë‹µë…¸íŠ¸
                <span class="badge" id="review-badge" style="display: none;">0</span>
            </button>
            <button class="tab" onclick="showSection('key-review')">ğŸ“š í•µì‹¬ ì˜¤ë‹µë…¸íŠ¸</button>
            <button class="tab" onclick="showSection('stats')">ğŸ“ˆ í†µê³„</button>
        </div>

        <div class="content">
            <!-- ëª¨ì˜ê³ ì‚¬ ì„¹ì…˜ -->
            <div id="quiz" class="section active">
                <h2 style="margin-bottom: 20px;">CBT ëª¨ì˜ê³ ì‚¬</h2>
                
                <div class="study-mode-selector">
                    <button class="mode-btn active" onclick="setQuizMode('all')">ì „ì²´</button>
                    <button class="mode-btn" onclick="setQuizMode('round_a')">1íšŒì°¨(A)</button>
                    <button class="mode-btn" onclick="setQuizMode('round_b')">2íšŒì°¨(B)</button>
                    <button class="mode-btn" onclick="setQuizMode('incorrect')">ì˜¤ë‹µë§Œ</button>
                    <button class="mode-btn" onclick="setQuizMode('bookmarked')">ë¶ë§ˆí¬</button>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="quiz-progress" style="width: 0%;"></div>
                </div>
                <div id="quiz-container" class="quiz-container">
                    <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>

            <!-- ì˜¤ë‹µë…¸íŠ¸ ì„¹ì…˜ (ë‚´ê°€ í‘¼ ë¬¸ì œ) -->
            <div id="review" class="section">
                <h2 style="margin-bottom: 20px;">ì˜¤ë‹µë…¸íŠ¸ & ë³µìŠµ</h2>
                <p style="margin-bottom: 20px; color: #666;">ë‚´ê°€ í‘¼ ë¬¸ì œì˜ ì˜¤ë‹µ ê¸°ë¡ì…ë‹ˆë‹¤.</p>
                
                <div class="review-filters">
                    <button class="filter-btn active" onclick="filterReview('all')">ì „ì²´</button>
                    <button class="filter-btn" onclick="filterReview('incorrect')">ì˜¤ë‹µë§Œ</button>
                    <button class="filter-btn" onclick="filterReview('correct')">ì •ë‹µ</button>
                    <button class="filter-btn" onclick="filterReview('bookmarked')">ë¶ë§ˆí¬</button>
                </div>
                
                <div id="review-container">
                    <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>

            <!-- í•µì‹¬ ì˜¤ë‹µë…¸íŠ¸ ì„¹ì…˜ (JSON ë°ì´í„°) -->
            <div id="key-review" class="section">
                <h2 style="margin-bottom: 20px;">ğŸ“š í•µì‹¬ ì˜¤ë‹µë…¸íŠ¸</h2>
                <p style="margin-bottom: 20px; color: #666;">ìì£¼ í‹€ë¦¬ëŠ” ì¤‘ìš”í•œ ê°œë…ë“¤ì„ ì •ë¦¬í•œ ì˜¤ë‹µë…¸íŠ¸ì…ë‹ˆë‹¤.</p>
                
                <div id="key-review-container">
                    <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>

            <!-- í†µê³„ ì„¹ì…˜ -->
            <div id="stats" class="section">
                <h2 style="margin-bottom: 20px;">í†µê³„ ëŒ€ì‹œë³´ë“œ</h2>
                
                <div class="stats-dashboard">
                    <div class="stat-card">
                        <h3 id="stat-total">0</h3>
                        <p>ì´ í•™ìŠµ ë¬¸ì œ</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="stat-correct">0%</h3>
                        <p>ì „ì²´ ì •ë‹µë¥ </p>
                    </div>
                    <div class="stat-card">
                        <h3 id="stat-weak">-</h3>
                        <p>ì·¨ì•½ ì˜ì—­</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="stat-strong">-</h3>
                        <p>ê°•ì  ì˜ì—­</p>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>ì¹´í…Œê³ ë¦¬ë³„ ì„±ê³¼</h3>
                    <div id="category-stats" style="margin-top: 20px;">
                        <!-- ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ê°€ ì—¬ê¸°ì— ë¡œë“œë¨ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // GitHub raw URL
        const QUESTIONS_URL = 'https://raw.githubusercontent.com/yunseoklee/cbtTest/main/questions.json';
        const REVIEW_NOTES_URL = 'https://raw.githubusercontent.com/yunseoklee/cbtTest/main/review-notes.json';

        // ì „ì—­ ë³€ìˆ˜
        let quizQuestions = [];
        let reviewData = { "ì˜¤ë‹µë…¸íŠ¸": [] };
        let currentQuestionIndex = 0;
        let score = 0;
        let answeredQuestions = [];
        let currentReviewFilter = 'all';
        let quizMode = 'all';
        let bookmarkedQuestions = new Set();
        let incorrectQuestions = new Set();
        let dataLoaded = false;

        // LocalStorage í‚¤
        const STORAGE_KEYS = {
            BOOKMARKED_QUESTIONS: 'istqb_bookmarked_questions',
            INCORRECT_QUESTIONS: 'istqb_incorrect_questions',
            ANSWERED_HISTORY: 'istqb_answered_history',
            STATS: 'istqb_stats'
        };

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async function() {
            loadFromStorage();
            await loadData();
            startQuiz(); // ì²« í™”ë©´ìœ¼ë¡œ ëª¨ì˜ê³ ì‚¬ í‘œì‹œ
            updateStats();
            updateReviewBadge();
        });

        // JSON ë°ì´í„° ë¡œë“œ
        async function loadData() {
            try {
                // ë¬¸ì œ ë°ì´í„° ë¡œë“œ
                const questionsResponse = await fetch(QUESTIONS_URL);
                const questionsData = await questionsResponse.json();
                
                // JSON êµ¬ì¡°ì— ë§ê²Œ íŒŒì‹±
                quizQuestions = questionsData.map(q => ({
                    id: q.id,
                    original_id: q.id,
                    question: q.question,
                    options: q.options,
                    correct: q.options.indexOf(q.correct_answer),
                    explanation: q.explanation,
                    chapter: q.chapter,
                    k_level: q.k_level,
                    category: 'istqb'
                }));

                // ì˜¤ë‹µë…¸íŠ¸ ë°ì´í„° ë¡œë“œ
                const reviewResponse = await fetch(REVIEW_NOTES_URL);
                reviewData = await reviewResponse.json();

                dataLoaded = true;
                console.log('ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', quizQuestions.length, 'ë¬¸ì œ');
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        // LocalStorageì—ì„œ ë°ì´í„° ë¡œë“œ
        function loadFromStorage() {
            try {
                const savedBookmarkedQuestions = localStorage.getItem(STORAGE_KEYS.BOOKMARKED_QUESTIONS);
                const savedIncorrectQuestions = localStorage.getItem(STORAGE_KEYS.INCORRECT_QUESTIONS);
                const savedAnsweredHistory = localStorage.getItem(STORAGE_KEYS.ANSWERED_HISTORY);
                
                if (savedBookmarkedQuestions) bookmarkedQuestions = new Set(JSON.parse(savedBookmarkedQuestions));
                if (savedIncorrectQuestions) incorrectQuestions = new Set(JSON.parse(savedIncorrectQuestions));
                if (savedAnsweredHistory) answeredQuestions = JSON.parse(savedAnsweredHistory);
            } catch (e) {
                console.error('Failed to load from storage:', e);
            }
        }

        // LocalStorageì— ë°ì´í„° ì €ì¥
        function saveToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.BOOKMARKED_QUESTIONS, JSON.stringify(Array.from(bookmarkedQuestions)));
                localStorage.setItem(STORAGE_KEYS.INCORRECT_QUESTIONS, JSON.stringify(Array.from(incorrectQuestions)));
                localStorage.setItem(STORAGE_KEYS.ANSWERED_HISTORY, JSON.stringify(answeredQuestions));
            } catch (e) {
                console.error('Failed to save to storage:', e);
            }
        }

        // ì„¹ì…˜ ì „í™˜
        function showSection(sectionName) {
            // ëª¨ë“  íƒ­ê³¼ ì„¹ì…˜ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ê³¼ ì„¹ì…˜ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(sectionName).classList.add('active');
            
            // ê° ì„¹ì…˜ë³„ ì´ˆê¸°í™”
            if (sectionName === 'quiz') {
                startQuiz();
            } else if (sectionName === 'review') {
                displayReviewItems();
            } else if (sectionName === 'key-review') {
                displayKeyReview();
            } else if (sectionName === 'stats') {
                displayStats();
            }
        }

        // ì¹´í…Œê³ ë¦¬ ì´ë¦„ ë³€í™˜
        function getCategoryName(category) {
            const names = {
                'foundation': 'í…ŒìŠ¤íŒ… ê¸°ì´ˆ',
                'lifecycle': 'ìƒëª…ì£¼ê¸°',
                'static': 'ì •ì  í…ŒìŠ¤íŒ…',
                'technique': 'í…ŒìŠ¤íŠ¸ ê¸°ë²•',
                'management': 'í…ŒìŠ¤íŠ¸ ê´€ë¦¬'
            };
            return names[category] || category;
        }

        // ëª¨ì˜ê³ ì‚¬ ëª¨ë“œ ì„¤ì •
        function setQuizMode(mode) {
            quizMode = mode;
            document.querySelectorAll('.study-mode-selector .mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            startQuiz();
        }

        // ëª¨ì˜ê³ ì‚¬ ì‹œì‘
        function startQuiz() {
            if (!dataLoaded || quizQuestions.length === 0) {
                document.getElementById('quiz-container').innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
                return;
            }

            currentQuestionIndex = 0;
            score = 0;
            
            // ëª¨ë“œì— ë”°ë¼ ë¬¸ì œ í•„í„°ë§
            let filteredQuestions = [...quizQuestions];
            
            if (quizMode === 'round_a') {
                filteredQuestions = quizQuestions.filter(q => {
                    return q.original_id && q.original_id.toString().startsWith('A');
                });
                if (filteredQuestions.length === 0) {
                    document.getElementById('quiz-container').innerHTML = `
                        <div style="text-align: center; padding: 50px;">
                            <h3>1íšŒì°¨(A) ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!</h3>
                            <button class="btn btn-primary" onclick="setQuizMode('all')">ì „ì²´ ë¬¸ì œ í’€ê¸°</button>
                        </div>
                    `;
                    return;
                }
            } else if (quizMode === 'round_b') {
                filteredQuestions = quizQuestions.filter(q => {
                    return q.original_id && q.original_id.toString().startsWith('B');
                });
                if (filteredQuestions.length === 0) {
                    document.getElementById('quiz-container').innerHTML = `
                        <div style="text-align: center; padding: 50px;">
                            <h3>2íšŒì°¨(B) ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!</h3>
                            <button class="btn btn-primary" onclick="setQuizMode('all')">ì „ì²´ ë¬¸ì œ í’€ê¸°</button>
                        </div>
                    `;
                    return;
                }
            } else if (quizMode === 'incorrect') {
                filteredQuestions = quizQuestions.filter(q => incorrectQuestions.has(q.id));
                if (filteredQuestions.length === 0) {
                    document.getElementById('quiz-container').innerHTML = `
                        <div style="text-align: center; padding: 50px;">
                            <h3>ì•„ì§ í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!</h3>
                            <p>ë¨¼ì € ì „ì²´ ë¬¸ì œë¥¼ í’€ì–´ë³´ì„¸ìš”.</p>
                            <button class="btn btn-primary" onclick="setQuizMode('all')">ì „ì²´ ë¬¸ì œ í’€ê¸°</button>
                        </div>
                    `;
                    return;
                }
            } else if (quizMode === 'bookmarked') {
                filteredQuestions = quizQuestions.filter(q => bookmarkedQuestions.has(q.id));
                if (filteredQuestions.length === 0) {
                    document.getElementById('quiz-container').innerHTML = `
                        <div style="text-align: center; padding: 50px;">
                            <h3>ë¶ë§ˆí¬í•œ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!</h3>
                            <p>ë¬¸ì œë¥¼ í’€ë©´ì„œ ë¶ë§ˆí¬ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
                            <button class="btn btn-primary" onclick="setQuizMode('all')">ì „ì²´ ë¬¸ì œ í’€ê¸°</button>
                        </div>
                    `;
                    return;
                }
            }
            
            shuffleArray(filteredQuestions);
            window.currentQuizQuestions = filteredQuestions;
            loadQuestion();
        }

        // ë¬¸ì œ ë¡œë“œ
        function loadQuestion() {
            const questions = window.currentQuizQuestions || quizQuestions;
            
            if (currentQuestionIndex >= questions.length) {
                showQuizResult();
                return;
            }
            
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('quiz-container');
            
            // ì§„ë„ ì—…ë°ì´íŠ¸
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('quiz-progress').style.width = progress + '%';
            
            container.innerHTML = `
                <div class="question-number">
                    ë¬¸ì œ ${currentQuestionIndex + 1} / ${questions.length}
                    ${bookmarkedQuestions.has(question.id) ? 'â­' : ''}
                </div>
                <div class="question">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) => `
                        <div class="option" onclick="selectOption(${index})">
                            <input type="radio" name="answer" value="${index}" id="option${index}">
                            <label for="option${index}" style="cursor: pointer; width: 100%;">${option}</label>
                        </div>
                    `).join('')}
                </div>
                <div id="explanation" style="display: none;"></div>
                <div class="quiz-controls">
                    <button class="btn btn-warning" onclick="bookmarkQuestion('${question.id}')">
                        ${bookmarkedQuestions.has(question.id) ? 'â­ ë¶ë§ˆí¬ í•´ì œ' : 'â˜† ë¶ë§ˆí¬'}
                    </button>
                    <button class="btn btn-secondary" onclick="skipQuestion()" id="skip-btn">ê±´ë„ˆë›°ê¸°</button>
                    <button class="btn btn-primary" onclick="submitAnswer()" id="submit-btn">ë‹µì•ˆ ì œì¶œ</button>
                    <button class="btn btn-success" onclick="nextQuestion()" id="next-btn" style="display: none;">ë‹¤ìŒ ë¬¸ì œ</button>
                </div>
            `;
        }

        // ë¬¸ì œ ë¶ë§ˆí¬
        function bookmarkQuestion(questionId) {
            if (bookmarkedQuestions.has(questionId)) {
                bookmarkedQuestions.delete(questionId);
            } else {
                bookmarkedQuestions.add(questionId);
            }
            saveToStorage();
            loadQuestion();
        }

        // ì˜µì…˜ ì„ íƒ
        function selectOption(index) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelectorAll('.option')[index].classList.add('selected');
            document.getElementById(`option${index}`).checked = true;
        }

        // ë‹µì•ˆ ì œì¶œ
        function submitAnswer() {
            const selected = document.querySelector('input[name="answer"]:checked');
            if (!selected) {
                alert('ë‹µì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }
            
            const selectedIndex = parseInt(selected.value);
            const questions = window.currentQuizQuestions || quizQuestions;
            const question = questions[currentQuestionIndex];
            const isCorrect = selectedIndex === question.correct;
            
            // ì •ë‹µ/ì˜¤ë‹µ í‘œì‹œ
            document.querySelectorAll('.option').forEach((opt, index) => {
                opt.onclick = null;
                if (index === question.correct) {
                    opt.classList.add('correct');
                } else if (index === selectedIndex && !isCorrect) {
                    opt.classList.add('incorrect');
                }
            });
            
            // ì˜¤ë‹µ ê¸°ë¡
            if (!isCorrect) {
                incorrectQuestions.add(question.id);
            } else {
                incorrectQuestions.delete(question.id);
            }
            
            // ì„¤ëª… í‘œì‹œ
            const explanationDiv = document.getElementById('explanation');
            explanationDiv.className = 'explanation';
            explanationDiv.style.display = 'block';
            explanationDiv.innerHTML = `
                <h4>${isCorrect ? 'âœ… ì •ë‹µì…ë‹ˆë‹¤!' : 'âŒ í‹€ë ¸ìŠµë‹ˆë‹¤.'}</h4>
                <p>${question.explanation}</p>
                <p style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">
                    ì¹´í…Œê³ ë¦¬: ${getCategoryName(question.category)}
                </p>
            `;
            
            if (isCorrect) score++;
            
            // ë‹µë³€ ê¸°ë¡ ì €ì¥
            answeredQuestions.push({
                questionId: question.id,
                question: question.question,
                userAnswer: selectedIndex,
                correctAnswer: question.correct,
                correct: isCorrect,
                category: question.category,
                timestamp: new Date().toISOString()
            });
            
            saveToStorage();
            updateStats();
            updateReviewBadge();
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('skip-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
        }

        // ë¬¸ì œ ê±´ë„ˆë›°ê¸°
        function skipQuestion() {
            const questions = window.currentQuizQuestions || quizQuestions;
            answeredQuestions.push({
                questionId: questions[currentQuestionIndex].id,
                question: questions[currentQuestionIndex].question,
                correct: false,
                skipped: true,
                category: questions[currentQuestionIndex].category,
                timestamp: new Date().toISOString()
            });
            currentQuestionIndex++;
            loadQuestion();
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        // ê²°ê³¼ í‘œì‹œ
        function showQuizResult() {
            const questions = window.currentQuizQuestions || quizQuestions;
            const container = document.getElementById('quiz-container');
            const percentage = Math.round((score / questions.length) * 100);
            
            container.innerHTML = `
                <div class="score-display">
                    <h2>ğŸ‰ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!</h2>
                    <h2>${score} / ${questions.length}</h2>
                    <p>ì •ë‹µë¥ : ${percentage}%</p>
                    <p>${percentage >= 70 ? 'í•©ê²© ê¸°ì¤€ì„ í†µê³¼í–ˆìŠµë‹ˆë‹¤!' : 'ë” ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.'}</p>
                    <button class="btn btn-primary" onclick="startQuiz()" style="margin-top: 20px;">ë‹¤ì‹œ ì‹œì‘</button>
                    <button class="btn btn-secondary" onclick="showSection('review')" style="margin-top: 20px;">ì˜¤ë‹µ í™•ì¸</button>
                </div>
            `;
        }

        // ì˜¤ë‹µë…¸íŠ¸ í•„í„°ë§
        function filterReview(filter) {
            currentReviewFilter = filter;
            document.querySelectorAll('.review-filters .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            displayReviewItems();
        }

        // ì˜¤ë‹µë…¸íŠ¸ í‘œì‹œ
        function displayReviewItems() {
            const container = document.getElementById('review-container');
            container.innerHTML = '';
            
            if (!dataLoaded) {
                container.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
                return;
            }
            
            // ìµœê·¼ ë‹µë³€ ê¸°ë¡
            let recentAnswers = answeredQuestions.slice(-20).reverse();
            
            // í•„í„° ì ìš©
            if (currentReviewFilter === 'incorrect') {
                recentAnswers = recentAnswers.filter(a => !a.correct && !a.skipped);
            } else if (currentReviewFilter === 'correct') {
                recentAnswers = recentAnswers.filter(a => a.correct);
            } else if (currentReviewFilter === 'bookmarked') {
                recentAnswers = recentAnswers.filter(a => bookmarkedQuestions.has(a.questionId));
            }
            
            if (recentAnswers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <h3>ì•„ì§ í•™ìŠµ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤!</h3>
                        <p>ëª¨ì˜ê³ ì‚¬ë¥¼ í’€ë©´ ì—¬ê¸°ì— ê¸°ë¡ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }
            
            // ìµœê·¼ í•™ìŠµ ê¸°ë¡ í‘œì‹œ
            recentAnswers.forEach(answer => {
                if (answer.skipped) return;
                
                const question = quizQuestions.find(q => q.id === answer.questionId);
                if (!question) return;
                
                const reviewItem = document.createElement('div');
                reviewItem.className = `review-item ${answer.correct ? 'correct' : 'incorrect'}`;
                
                reviewItem.innerHTML = `
                    <div class="review-header">
                        <div class="review-status">
                            <span class="review-tag ${answer.correct ? 'tag-correct' : 'tag-incorrect'}">
                                ${answer.correct ? 'ì •ë‹µ' : 'ì˜¤ë‹µ'}
                            </span>
                            <span class="review-tag tag-category">${getCategoryName(question.category)}</span>
                        </div>
                        <button class="btn btn-warning" style="padding: 5px 15px; font-size: 12px;" 
                                onclick="bookmarkQuestion('${question.id}')">
                            ${bookmarkedQuestions.has(question.id) ? 'â­' : 'â˜†'}
                        </button>
                    </div>
                    <div class="review-question">${question.question}</div>
                    <div class="review-options">
                        ${question.options.map((option, index) => `
                            <div class="review-option ${index === answer.userAnswer ? 'user-selected' : ''} 
                                        ${index === question.correct ? 'correct-answer' : ''}">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    <div class="review-explanation">
                        <h4>ğŸ’¡ í•´ì„¤</h4>
                        <p>${question.explanation}</p>
                    </div>
                `;
                
                container.appendChild(reviewItem);
            });
        }

        // í•µì‹¬ ì˜¤ë‹µë…¸íŠ¸ í‘œì‹œ
        function displayKeyReview() {
            const container = document.getElementById('key-review-container');
            container.innerHTML = '';
            
            if (!dataLoaded) {
                container.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
                return;
            }
            
            if (reviewData["ì˜¤ë‹µë…¸íŠ¸"].length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <h3>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</h3>
                    </div>
                `;
                return;
            }
            
            reviewData["ì˜¤ë‹µë…¸íŠ¸"].forEach(item => {
                const reviewItem = document.createElement('div');
                reviewItem.className = 'review-item';
                reviewItem.style.borderLeft = '5px solid #3498db';
                
                reviewItem.innerHTML = `
                    <div class="review-header">
                        <div class="review-status">
                            <span class="review-tag tag-category">${item.ì¹´í…Œê³ ë¦¬}</span>
                        </div>
                    </div>
                    <div class="review-question">${item.ë¬¸ì œ}</div>
                    <div class="review-explanation">
                        <h4>âœ… ì •ë‹µ</h4>
                        <p>${item.ë‹µë³€}</p>
                    </div>
                `;
                
                container.appendChild(reviewItem);
            });
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const totalAnswered = answeredQuestions.filter(a => !a.skipped).length;
            const correctAnswers = answeredQuestions.filter(a => a.correct).length;
            const correctRate = totalAnswered > 0 ? Math.round((correctAnswers / totalAnswered) * 100) : 0;
            
            document.getElementById('total-solved').textContent = totalAnswered;
            document.getElementById('correct-rate').textContent = correctRate + '%';
            
            // ì—°ì† í•™ìŠµì¼ ê³„ì‚°
            const today = new Date().toDateString();
            const lastStudy = localStorage.getItem('last_study_date');
            let streak = parseInt(localStorage.getItem('study_streak') || '0');
            
            if (lastStudy !== today) {
                streak = lastStudy === new Date(Date.now() - 86400000).toDateString() ? streak + 1 : 1;
                localStorage.setItem('study_streak', streak.toString());
                localStorage.setItem('last_study_date', today);
            }
            
            document.getElementById('study-streak').textContent = streak + 'ì¼';
        }

        // ë¦¬ë·° ë°°ì§€ ì—…ë°ì´íŠ¸
        function updateReviewBadge() {
            const incorrectCount = incorrectQuestions.size;
            const badge = document.getElementById('review-badge');
            
            if (incorrectCount > 0) {
                badge.textContent = incorrectCount;
                badge.style.display = 'inline-block';
            } else {
                badge.style.display = 'none';
            }
        }

        // í†µê³„ í‘œì‹œ
        function displayStats() {
            const totalAnswered = answeredQuestions.filter(a => !a.skipped).length;
            const correctAnswers = answeredQuestions.filter(a => a.correct).length;
            const correctRate = totalAnswered > 0 ? Math.round((correctAnswers / totalAnswered) * 100) : 0;
            
            document.getElementById('stat-total').textContent = totalAnswered;
            document.getElementById('stat-correct').textContent = correctRate + '%';
            
            // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ ê³„ì‚°
            const categoryStats = {};
            answeredQuestions.forEach(answer => {
                if (!answer.skipped && answer.category) {
                    if (!categoryStats[answer.category]) {
                        categoryStats[answer.category] = { total: 0, correct: 0 };
                    }
                    categoryStats[answer.category].total++;
                    if (answer.correct) {
                        categoryStats[answer.category].correct++;
                    }
                }
            });
            
            // ì·¨ì•½/ê°•ì  ì˜ì—­ ì°¾ê¸°
            let weakestCategory = '-';
            let strongestCategory = '-';
            let lowestRate = 100;
            let highestRate = 0;
            
            Object.entries(categoryStats).forEach(([category, stats]) => {
                const rate = (stats.correct / stats.total) * 100;
                if (rate < lowestRate) {
                    lowestRate = rate;
                    weakestCategory = getCategoryName(category);
                }
                if (rate > highestRate) {
                    highestRate = rate;
                    strongestCategory = getCategoryName(category);
                }
            });
            
            document.getElementById('stat-weak').textContent = weakestCategory;
            document.getElementById('stat-strong').textContent = strongestCategory;
            
            // ì¹´í…Œê³ ë¦¬ë³„ ìƒì„¸ í†µê³„ í‘œì‹œ
            const categoryStatsContainer = document.getElementById('category-stats');
            categoryStatsContainer.innerHTML = '';
            
            Object.entries(categoryStats).forEach(([category, stats]) => {
                const rate = Math.round((stats.correct / stats.total) * 100);
                const statItem = document.createElement('div');
                statItem.style.marginBottom = '15px';
                
                statItem.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <span>${getCategoryName(category)}</span>
                        <span>${stats.correct}/${stats.total} (${rate}%)</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${rate}%; background: ${rate >= 70 ? '#27ae60' : rate >= 50 ? '#f39c12' : '#e74c3c'};"></div>
                    </div>
                `;
                
                categoryStatsContainer.appendChild(statItem);
            });
        }

        // ë°°ì—´ ì„ê¸° í•¨ìˆ˜
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
    </script>
</body>
</html>
