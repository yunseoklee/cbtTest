<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISTQB CTFL 모의고사 CBT - Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stats-bar {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
            display: flex;
            justify-content: space-around;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 100px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
            position: relative;
        }

        .tab.active {
            background: white;
            color: #5e72e4;
            border-bottom: 3px solid #5e72e4;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab .badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 11px;
        }

        .content {
            padding: 30px;
            min-height: 500px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 용어 학습 스타일 */
        .term-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            position: relative;
        }

        .term-card.bookmarked {
            border: 2px solid #f39c12;
        }

        .bookmark-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #ddd;
        }

        .bookmark-btn.active {
            color: #f39c12;
        }

        .term-title {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: bold;
            padding-right: 40px;
        }

        .term-definition {
            font-size: 16px;
            line-height: 1.8;
            color: #34495e;
            margin-bottom: 15px;
        }

        .term-importance {
            display: inline-block;
            padding: 5px 15px;
            background: #e74c3c;
            color: white;
            border-radius: 20px;
            font-size: 14px;
            margin-right: 10px;
        }

        .term-category {
            display: inline-block;
            padding: 5px 15px;
            background: #3498db;
            color: white;
            border-radius: 20px;
            font-size: 14px;
        }

        /* 모의고사 스타일 */
        .quiz-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
        }

        .question {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 25px;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .question-number {
            display: inline-block;
            background: #5e72e4;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .options {
            margin-bottom: 20px;
        }

        .option {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: #5e72e4;
            background: #f8f9ff;
        }

        .option.selected {
            border-color: #5e72e4;
            background: #e8ebff;
        }

        .option.correct {
            border-color: #27ae60;
            background: #d4edda;
        }

        .option.incorrect {
            border-color: #e74c3c;
            background: #f8d7da;
        }

        .option input[type="radio"] {
            margin-right: 15px;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(94, 114, 228, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .score-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            margin-top: 20px;
        }

        .score-display h2 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        /* 오답노트 스타일 */
        .review-item {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .review-item.incorrect {
            border-left: 5px solid #e74c3c;
        }

        .review-item.correct {
            border-left: 5px solid #27ae60;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .review-status {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .review-tag {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .tag-incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        .tag-correct {
            background: #d4edda;
            color: #155724;
        }

        .tag-category {
            background: #cce5ff;
            color: #004085;
        }

        .review-question {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            white-space: pre-wrap;
        }

        .review-options {
            margin-bottom: 20px;
        }

        .review-option {
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: #f8f9fa;
            position: relative;
            padding-left: 35px;
        }

        .review-option.user-selected {
            background: #fff3cd;
            border: 1px solid #ffc107;
        }

        .review-option.correct-answer {
            background: #d4edda;
            border: 1px solid #27ae60;
        }

        .review-option::before {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .review-option.user-selected::before {
            content: "👤";
        }

        .review-option.correct-answer::before {
            content: "✅";
        }

        .review-explanation {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .review-explanation h4 {
            color: #2980b9;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .review-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 20px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .filter-btn.active {
            background: #5e72e4;
            color: white;
            border-color: #5e72e4;
        }

        /* 학습 진도 */
        .progress-bar {
            background: #dee2e6;
            height: 10px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #5e72e4, #825ee4);
            height: 100%;
            transition: width 0.5s;
        }

        .explanation {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
        }

        .explanation h4 {
            color: #2980b9;
            margin-bottom: 10px;
        }

        /* 플래시카드 스타일 개선 */
        .flashcard-container {
            perspective: 1000px;
            margin-bottom: 30px;
        }

        .flashcard {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 40px;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.6s;
            transform-style: preserve-3d;
            position: relative;
        }

        .flashcard:hover {
            transform: scale(1.02);
        }

        .difficulty-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 5px 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            font-size: 12px;
        }

        .study-mode-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #5e72e4;
            background: white;
            color: #5e72e4;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: #5e72e4;
            color: white;
        }

        /* 통계 대시보드 */
        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .tabs {
                overflow-x: auto;
            }
            
            .tab {
                min-width: 120px;
            }
            
            .quiz-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎓 ISTQB CTFL 모의고사</h1>
            <p>Certified Tester Foundation Level v4.0</p>
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="total-solved">0</div>
                    <div class="stat-label">총 문제</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="correct-rate">0%</div>
                    <div class="stat-label">정답률</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="study-streak">0</div>
                    <div class="stat-label">연속 학습</div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showSection('quiz')">📝 모의고사</button>
            <button class="tab" onclick="showSection('review')">
                📊 오답노트
                <span class="badge" id="review-badge" style="display: none;">0</span>
            </button>
            <button class="tab" onclick="showSection('key-review')">📚 핵심 오답노트</button>
            <button class="tab" onclick="showSection('stats')">📈 통계</button>
        </div>

        <div class="content">
            <!-- 모의고사 섹션 -->
            <div id="quiz" class="section active">
                <h2 style="margin-bottom: 20px;">CBT 모의고사</h2>
                
                <div class="study-mode-selector">
                    <button class="mode-btn active" onclick="setQuizMode('all')">전체</button>
                    <button class="mode-btn" onclick="setQuizMode('round_a')">1회차(A)</button>
                    <button class="mode-btn" onclick="setQuizMode('round_b')">2회차(B)</button>
                    <button class="mode-btn" onclick="setQuizMode('incorrect')">오답만</button>
                    <button class="mode-btn" onclick="setQuizMode('bookmarked')">북마크</button>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="quiz-progress" style="width: 0%;"></div>
                </div>
                <div id="quiz-container" class="quiz-container">
                    <div class="loading">데이터를 불러오는 중...</div>
                </div>
            </div>

            <!-- 오답노트 섹션 (내가 푼 문제) -->
            <div id="review" class="section">
                <h2 style="margin-bottom: 20px;">오답노트 & 복습</h2>
                <p style="margin-bottom: 20px; color: #666;">내가 푼 문제의 오답 기록입니다.</p>
                
                <div class="review-filters">
                    <button class="filter-btn active" onclick="filterReview('all')">전체</button>
                    <button class="filter-btn" onclick="filterReview('incorrect')">오답만</button>
                    <button class="filter-btn" onclick="filterReview('correct')">정답</button>
                    <button class="filter-btn" onclick="filterReview('bookmarked')">북마크</button>
                </div>
                
                <div id="review-container">
                    <div class="loading">데이터를 불러오는 중...</div>
                </div>
            </div>

            <!-- 핵심 오답노트 섹션 (JSON 데이터) -->
            <div id="key-review" class="section">
                <h2 style="margin-bottom: 20px;">📚 핵심 오답노트</h2>
                <p style="margin-bottom: 20px; color: #666;">자주 틀리는 중요한 개념들을 정리한 오답노트입니다.</p>
                
                <div id="key-review-container">
                    <div class="loading">데이터를 불러오는 중...</div>
                </div>
            </div>

            <!-- 통계 섹션 -->
            <div id="stats" class="section">
                <h2 style="margin-bottom: 20px;">통계 대시보드</h2>
                
                <div class="stats-dashboard">
                    <div class="stat-card">
                        <h3 id="stat-total">0</h3>
                        <p>총 학습 문제</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="stat-correct">0%</h3>
                        <p>전체 정답률</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="stat-weak">-</h3>
                        <p>취약 영역</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="stat-strong">-</h3>
                        <p>강점 영역</p>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>카테고리별 성과</h3>
                    <div id="category-stats" style="margin-top: 20px;">
                        <!-- 카테고리별 통계가 여기에 로드됨 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // GitHub raw URL
        const QUESTIONS_URL = 'https://raw.githubusercontent.com/yunseoklee/cbtTest/main/questions.json';
        const REVIEW_NOTES_URL = 'https://raw.githubusercontent.com/yunseoklee/cbtTest/main/review-notes.json';

        // 전역 변수
        let quizQuestions = [];
        let reviewData = { "오답노트": [] };
        let currentQuestionIndex = 0;
        let score = 0;
        let answeredQuestions = [];
        let currentReviewFilter = 'all';
        let quizMode = 'all';
        let bookmarkedQuestions = new Set();
        let incorrectQuestions = new Set();
        let dataLoaded = false;

        // LocalStorage 키
        const STORAGE_KEYS = {
            BOOKMARKED_QUESTIONS: 'istqb_bookmarked_questions',
            INCORRECT_QUESTIONS: 'istqb_incorrect_questions',
            ANSWERED_HISTORY: 'istqb_answered_history',
            STATS: 'istqb_stats'
        };

        // 초기화
        document.addEventListener('DOMContentLoaded', async function() {
            loadFromStorage();
            await loadData();
            startQuiz(); // 첫 화면으로 모의고사 표시
            updateStats();
            updateReviewBadge();
        });

        // JSON 데이터 로드
        async function loadData() {
            try {
                // 문제 데이터 로드
                const questionsResponse = await fetch(QUESTIONS_URL);
                const questionsData = await questionsResponse.json();
                
                // JSON 구조에 맞게 파싱
                quizQuestions = questionsData.map(q => ({
                    id: q.id,
                    original_id: q.id,
                    question: q.question,
                    options: q.options,
                    correct: q.options.indexOf(q.correct_answer),
                    explanation: q.explanation,
                    chapter: q.chapter,
                    k_level: q.k_level,
                    category: 'istqb'
                }));

                // 오답노트 데이터 로드
                const reviewResponse = await fetch(REVIEW_NOTES_URL);
                reviewData = await reviewResponse.json();

                dataLoaded = true;
                console.log('데이터 로드 완료:', quizQuestions.length, '문제');
            } catch (error) {
                console.error('데이터 로드 실패:', error);
                alert('데이터를 불러오는데 실패했습니다. 네트워크 연결을 확인해주세요.');
            }
        }

        // LocalStorage에서 데이터 로드
        function loadFromStorage() {
            try {
                const savedBookmarkedQuestions = localStorage.getItem(STORAGE_KEYS.BOOKMARKED_QUESTIONS);
                const savedIncorrectQuestions = localStorage.getItem(STORAGE_KEYS.INCORRECT_QUESTIONS);
                const savedAnsweredHistory = localStorage.getItem(STORAGE_KEYS.ANSWERED_HISTORY);
                
                if (savedBookmarkedQuestions) bookmarkedQuestions = new Set(JSON.parse(savedBookmarkedQuestions));
                if (savedIncorrectQuestions) incorrectQuestions = new Set(JSON.parse(savedIncorrectQuestions));
                if (savedAnsweredHistory) answeredQuestions = JSON.parse(savedAnsweredHistory);
            } catch (e) {
                console.error('Failed to load from storage:', e);
            }
        }

        // LocalStorage에 데이터 저장
        function saveToStorage() {
            try {
                localStorage.setItem(STORAGE_KEYS.BOOKMARKED_QUESTIONS, JSON.stringify(Array.from(bookmarkedQuestions)));
                localStorage.setItem(STORAGE_KEYS.INCORRECT_QUESTIONS, JSON.stringify(Array.from(incorrectQuestions)));
                localStorage.setItem(STORAGE_KEYS.ANSWERED_HISTORY, JSON.stringify(answeredQuestions));
            } catch (e) {
                console.error('Failed to save to storage:', e);
            }
        }

        // 섹션 전환
        function showSection(sectionName) {
            // 모든 탭과 섹션 비활성화
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            
            // 선택된 탭과 섹션 활성화
            event.target.classList.add('active');
            document.getElementById(sectionName).classList.add('active');
            
            // 각 섹션별 초기화
            if (sectionName === 'quiz') {
                startQuiz();
            } else if (sectionName === 'review') {
                displayReviewItems();
            } else if (sectionName === 'key-review') {
                displayKeyReview();
            } else if (sectionName === 'stats') {
                displayStats();
            }
        }

        // 카테고리 이름 변환
        function getCategoryName(category) {
            const names = {
                'foundation': '테스팅 기초',
                'lifecycle': '생명주기',
                'static': '정적 테스팅',
                'technique': '테스트 기법',
                'management': '테스트 관리'
            };
            return names[category] || category;
        }

        // 모의고사 모드 설정
        function setQuizMode(mode) {
            quizMode = mode;
            document.querySelectorAll('.study-mode-selector .mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            startQuiz();
        }

        // 모의고사 시작
        function startQuiz() {
            if (!dataLoaded || quizQuestions.length === 0) {
                document.getElementById('quiz-container').innerHTML = '<div class="loading">데이터를 불러오는 중...</div>';
                return;
            }

            currentQuestionIndex = 0;
            score = 0;
            
            // 모드에 따라 문제 필터링
            let filteredQuestions = [...quizQuestions];
            
            if (quizMode === 'round_a') {
                filteredQuestions = quizQuestions.filter(q => {
                    return q.original_id && q.original_id.toString().startsWith('A');
                });
                if (filteredQuestions.length === 0) {
                    document.getElementById('quiz-container').innerHTML = `
                        <div style="text-align: center; padding: 50px;">
                            <h3>1회차(A) 문제가 없습니다!</h3>
                            <button class="btn btn-primary" onclick="setQuizMode('all')">전체 문제 풀기</button>
                        </div>
                    `;
                    return;
                }
            } else if (quizMode === 'round_b') {
                filteredQuestions = quizQuestions.filter(q => {
                    return q.original_id && q.original_id.toString().startsWith('B');
                });
                if (filteredQuestions.length === 0) {
                    document.getElementById('quiz-container').innerHTML = `
                        <div style="text-align: center; padding: 50px;">
                            <h3>2회차(B) 문제가 없습니다!</h3>
                            <button class="btn btn-primary" onclick="setQuizMode('all')">전체 문제 풀기</button>
                        </div>
                    `;
                    return;
                }
            } else if (quizMode === 'incorrect') {
                filteredQuestions = quizQuestions.filter(q => incorrectQuestions.has(q.id));
                if (filteredQuestions.length === 0) {
                    document.getElementById('quiz-container').innerHTML = `
                        <div style="text-align: center; padding: 50px;">
                            <h3>아직 틀린 문제가 없습니다!</h3>
                            <p>먼저 전체 문제를 풀어보세요.</p>
                            <button class="btn btn-primary" onclick="setQuizMode('all')">전체 문제 풀기</button>
                        </div>
                    `;
                    return;
                }
            } else if (quizMode === 'bookmarked') {
                filteredQuestions = quizQuestions.filter(q => bookmarkedQuestions.has(q.id));
                if (filteredQuestions.length === 0) {
                    document.getElementById('quiz-container').innerHTML = `
                        <div style="text-align: center; padding: 50px;">
                            <h3>북마크한 문제가 없습니다!</h3>
                            <p>문제를 풀면서 북마크를 추가해보세요.</p>
                            <button class="btn btn-primary" onclick="setQuizMode('all')">전체 문제 풀기</button>
                        </div>
                    `;
                    return;
                }
            }
            
            shuffleArray(filteredQuestions);
            window.currentQuizQuestions = filteredQuestions;
            loadQuestion();
        }

        // 문제 로드
        function loadQuestion() {
            const questions = window.currentQuizQuestions || quizQuestions;
            
            if (currentQuestionIndex >= questions.length) {
                showQuizResult();
                return;
            }
            
            const question = questions[currentQuestionIndex];
            const container = document.getElementById('quiz-container');
            
            // 진도 업데이트
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('quiz-progress').style.width = progress + '%';
            
            container.innerHTML = `
                <div class="question-number">
                    문제 ${currentQuestionIndex + 1} / ${questions.length}
                    ${bookmarkedQuestions.has(question.id) ? '⭐' : ''}
                </div>
                <div class="question">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, index) => `
                        <div class="option" onclick="selectOption(${index})">
                            <input type="radio" name="answer" value="${index}" id="option${index}">
                            <label for="option${index}" style="cursor: pointer; width: 100%;">${option}</label>
                        </div>
                    `).join('')}
                </div>
                <div id="explanation" style="display: none;"></div>
                <div class="quiz-controls">
                    <button class="btn btn-warning" onclick="bookmarkQuestion('${question.id}')">
                        ${bookmarkedQuestions.has(question.id) ? '⭐ 북마크 해제' : '☆ 북마크'}
                    </button>
                    <button class="btn btn-secondary" onclick="skipQuestion()" id="skip-btn">건너뛰기</button>
                    <button class="btn btn-primary" onclick="submitAnswer()" id="submit-btn">답안 제출</button>
                    <button class="btn btn-success" onclick="nextQuestion()" id="next-btn" style="display: none;">다음 문제</button>
                </div>
            `;
        }

        // 문제 북마크
        function bookmarkQuestion(questionId) {
            if (bookmarkedQuestions.has(questionId)) {
                bookmarkedQuestions.delete(questionId);
            } else {
                bookmarkedQuestions.add(questionId);
            }
            saveToStorage();
            loadQuestion();
        }

        // 옵션 선택
        function selectOption(index) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelectorAll('.option')[index].classList.add('selected');
            document.getElementById(`option${index}`).checked = true;
        }

        // 답안 제출
        function submitAnswer() {
            const selected = document.querySelector('input[name="answer"]:checked');
            if (!selected) {
                alert('답을 선택해주세요!');
                return;
            }
            
            const selectedIndex = parseInt(selected.value);
            const questions = window.currentQuizQuestions || quizQuestions;
            const question = questions[currentQuestionIndex];
            const isCorrect = selectedIndex === question.correct;
            
            // 정답/오답 표시
            document.querySelectorAll('.option').forEach((opt, index) => {
                opt.onclick = null;
                if (index === question.correct) {
                    opt.classList.add('correct');
                } else if (index === selectedIndex && !isCorrect) {
                    opt.classList.add('incorrect');
                }
            });
            
            // 오답 기록
            if (!isCorrect) {
                incorrectQuestions.add(question.id);
            } else {
                incorrectQuestions.delete(question.id);
            }
            
            // 설명 표시
            const explanationDiv = document.getElementById('explanation');
            explanationDiv.className = 'explanation';
            explanationDiv.style.display = 'block';
            explanationDiv.innerHTML = `
                <h4>${isCorrect ? '✅ 정답입니다!' : '❌ 틀렸습니다.'}</h4>
                <p>${question.explanation}</p>
                <p style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">
                    카테고리: ${getCategoryName(question.category)}
                </p>
            `;
            
            if (isCorrect) score++;
            
            // 답변 기록 저장
            answeredQuestions.push({
                questionId: question.id,
                question: question.question,
                userAnswer: selectedIndex,
                correctAnswer: question.correct,
                correct: isCorrect,
                category: question.category,
                timestamp: new Date().toISOString()
            });
            
            saveToStorage();
            updateStats();
            updateReviewBadge();
            
            // 버튼 상태 변경
            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('skip-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
        }

        // 문제 건너뛰기
        function skipQuestion() {
            const questions = window.currentQuizQuestions || quizQuestions;
            answeredQuestions.push({
                questionId: questions[currentQuestionIndex].id,
                question: questions[currentQuestionIndex].question,
                correct: false,
                skipped: true,
                category: questions[currentQuestionIndex].category,
                timestamp: new Date().toISOString()
            });
            currentQuestionIndex++;
            loadQuestion();
        }

        // 다음 문제
        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        // 결과 표시
        function showQuizResult() {
            const questions = window.currentQuizQuestions || quizQuestions;
            const container = document.getElementById('quiz-container');
            const percentage = Math.round((score / questions.length) * 100);
            
            container.innerHTML = `
                <div class="score-display">
                    <h2>🎉 테스트 완료!</h2>
                    <h2>${score} / ${questions.length}</h2>
                    <p>정답률: ${percentage}%</p>
                    <p>${percentage >= 70 ? '합격 기준을 통과했습니다!' : '더 연습이 필요합니다.'}</p>
                    <button class="btn btn-primary" onclick="startQuiz()" style="margin-top: 20px;">다시 시작</button>
                    <button class="btn btn-secondary" onclick="showSection('review')" style="margin-top: 20px;">오답 확인</button>
                </div>
            `;
        }

        // 오답노트 필터링
        function filterReview(filter) {
            currentReviewFilter = filter;
            document.querySelectorAll('.review-filters .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            displayReviewItems();
        }

        // 오답노트 표시
        function displayReviewItems() {
            const container = document.getElementById('review-container');
            container.innerHTML = '';
            
            if (!dataLoaded) {
                container.innerHTML = '<div class="loading">데이터를 불러오는 중...</div>';
                return;
            }
            
            // 최근 답변 기록
            let recentAnswers = answeredQuestions.slice(-20).reverse();
            
            // 필터 적용
            if (currentReviewFilter === 'incorrect') {
                recentAnswers = recentAnswers.filter(a => !a.correct && !a.skipped);
            } else if (currentReviewFilter === 'correct') {
                recentAnswers = recentAnswers.filter(a => a.correct);
            } else if (currentReviewFilter === 'bookmarked') {
                recentAnswers = recentAnswers.filter(a => bookmarkedQuestions.has(a.questionId));
            }
            
            if (recentAnswers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <h3>아직 학습 기록이 없습니다!</h3>
                        <p>모의고사를 풀면 여기에 기록이 나타납니다.</p>
                    </div>
                `;
                return;
            }
            
            // 최근 학습 기록 표시
            recentAnswers.forEach(answer => {
                if (answer.skipped) return;
                
                const question = quizQuestions.find(q => q.id === answer.questionId);
                if (!question) return;
                
                const reviewItem = document.createElement('div');
                reviewItem.className = `review-item ${answer.correct ? 'correct' : 'incorrect'}`;
                
                reviewItem.innerHTML = `
                    <div class="review-header">
                        <div class="review-status">
                            <span class="review-tag ${answer.correct ? 'tag-correct' : 'tag-incorrect'}">
                                ${answer.correct ? '정답' : '오답'}
                            </span>
                            <span class="review-tag tag-category">${getCategoryName(question.category)}</span>
                        </div>
                        <button class="btn btn-warning" style="padding: 5px 15px; font-size: 12px;" 
                                onclick="bookmarkQuestion('${question.id}')">
                            ${bookmarkedQuestions.has(question.id) ? '⭐' : '☆'}
                        </button>
                    </div>
                    <div class="review-question">${question.question}</div>
                    <div class="review-options">
                        ${question.options.map((option, index) => `
                            <div class="review-option ${index === answer.userAnswer ? 'user-selected' : ''} 
                                        ${index === question.correct ? 'correct-answer' : ''}">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    <div class="review-explanation">
                        <h4>💡 해설</h4>
                        <p>${question.explanation}</p>
                    </div>
                `;
                
                container.appendChild(reviewItem);
            });
        }

        // 핵심 오답노트 표시
        function displayKeyReview() {
            const container = document.getElementById('key-review-container');
            container.innerHTML = '';
            
            if (!dataLoaded) {
                container.innerHTML = '<div class="loading">데이터를 불러오는 중...</div>';
                return;
            }
            
            if (reviewData["오답노트"].length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <h3>데이터를 불러오는 중입니다...</h3>
                    </div>
                `;
                return;
            }
            
            reviewData["오답노트"].forEach(item => {
                const reviewItem = document.createElement('div');
                reviewItem.className = 'review-item';
                reviewItem.style.borderLeft = '5px solid #3498db';
                
                reviewItem.innerHTML = `
                    <div class="review-header">
                        <div class="review-status">
                            <span class="review-tag tag-category">${item.카테고리}</span>
                        </div>
                    </div>
                    <div class="review-question">${item.문제}</div>
                    <div class="review-explanation">
                        <h4>✅ 정답</h4>
                        <p>${item.답변}</p>
                    </div>
                `;
                
                container.appendChild(reviewItem);
            });
        }

        // 통계 업데이트
        function updateStats() {
            const totalAnswered = answeredQuestions.filter(a => !a.skipped).length;
            const correctAnswers = answeredQuestions.filter(a => a.correct).length;
            const correctRate = totalAnswered > 0 ? Math.round((correctAnswers / totalAnswered) * 100) : 0;
            
            document.getElementById('total-solved').textContent = totalAnswered;
            document.getElementById('correct-rate').textContent = correctRate + '%';
            
            // 연속 학습일 계산
            const today = new Date().toDateString();
            const lastStudy = localStorage.getItem('last_study_date');
            let streak = parseInt(localStorage.getItem('study_streak') || '0');
            
            if (lastStudy !== today) {
                streak = lastStudy === new Date(Date.now() - 86400000).toDateString() ? streak + 1 : 1;
                localStorage.setItem('study_streak', streak.toString());
                localStorage.setItem('last_study_date', today);
            }
            
            document.getElementById('study-streak').textContent = streak + '일';
        }

        // 리뷰 배지 업데이트
        function updateReviewBadge() {
            const incorrectCount = incorrectQuestions.size;
            const badge = document.getElementById('review-badge');
            
            if (incorrectCount > 0) {
                badge.textContent = incorrectCount;
                badge.style.display = 'inline-block';
            } else {
                badge.style.display = 'none';
            }
        }

        // 통계 표시
        function displayStats() {
            const totalAnswered = answeredQuestions.filter(a => !a.skipped).length;
            const correctAnswers = answeredQuestions.filter(a => a.correct).length;
            const correctRate = totalAnswered > 0 ? Math.round((correctAnswers / totalAnswered) * 100) : 0;
            
            document.getElementById('stat-total').textContent = totalAnswered;
            document.getElementById('stat-correct').textContent = correctRate + '%';
            
            // 카테고리별 통계 계산
            const categoryStats = {};
            answeredQuestions.forEach(answer => {
                if (!answer.skipped && answer.category) {
                    if (!categoryStats[answer.category]) {
                        categoryStats[answer.category] = { total: 0, correct: 0 };
                    }
                    categoryStats[answer.category].total++;
                    if (answer.correct) {
                        categoryStats[answer.category].correct++;
                    }
                }
            });
            
            // 취약/강점 영역 찾기
            let weakestCategory = '-';
            let strongestCategory = '-';
            let lowestRate = 100;
            let highestRate = 0;
            
            Object.entries(categoryStats).forEach(([category, stats]) => {
                const rate = (stats.correct / stats.total) * 100;
                if (rate < lowestRate) {
                    lowestRate = rate;
                    weakestCategory = getCategoryName(category);
                }
                if (rate > highestRate) {
                    highestRate = rate;
                    strongestCategory = getCategoryName(category);
                }
            });
            
            document.getElementById('stat-weak').textContent = weakestCategory;
            document.getElementById('stat-strong').textContent = strongestCategory;
            
            // 카테고리별 상세 통계 표시
            const categoryStatsContainer = document.getElementById('category-stats');
            categoryStatsContainer.innerHTML = '';
            
            Object.entries(categoryStats).forEach(([category, stats]) => {
                const rate = Math.round((stats.correct / stats.total) * 100);
                const statItem = document.createElement('div');
                statItem.style.marginBottom = '15px';
                
                statItem.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <span>${getCategoryName(category)}</span>
                        <span>${stats.correct}/${stats.total} (${rate}%)</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${rate}%; background: ${rate >= 70 ? '#27ae60' : rate >= 50 ? '#f39c12' : '#e74c3c'};"></div>
                    </div>
                `;
                
                categoryStatsContainer.appendChild(statItem);
            });
        }

        // 배열 섞기 함수
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
    </script>
</body>
</html>
